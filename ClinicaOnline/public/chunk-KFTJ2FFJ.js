import{b as y,c as $}from"./chunk-X7I35JOR.js";import{a as D,b as B,c as j,d as q,e as z,f as G,g as Q,h as H,i as K,j as J,m as X,p as Y}from"./chunk-GS6HGKLI.js";import{Ba as N,D as s,E as V,Ia as F,Ja as A,L as C,Ma as Z,N as g,Na as E,P as n,Q as o,R as w,U as b,V as h,W as c,Y as R,Z as k,_ as T,aa as l,ba as M,ca as I,fa as m,ga as u,ha as f,ja as W,o as O,s as d,t as p,ua as L,va as U}from"./chunk-DKADGSXX.js";import"./chunk-SZXJF6TW.js";import{i as S}from"./chunk-P2VZOJAX.js";function te(a,_){if(a&1){let e=b();n(0,"div",5)(1,"button",6),h("click",function(){d(e);let t=c();return p(t.setTipoUsuario("paciente"))}),w(2,"img",7),n(3,"span"),l(4,"Paciente"),o()(),n(5,"button",6),h("click",function(){d(e);let t=c();return p(t.setTipoUsuario("especialista"))}),w(6,"img",8),n(7,"span"),l(8,"Especialista"),o()()()}}function ie(a,_){if(a&1){let e=b();n(0,"fieldset")(1,"legend"),l(2,"Datos del Paciente"),o(),n(3,"div",10)(4,"label"),l(5,"Obra Social:"),o(),n(6,"select",27),f("ngModelChange",function(t){d(e);let i=c(2);return u(i.obraSocial,t)||(i.obraSocial=t),p(t)}),n(7,"option",28),l(8,"Seleccion\xE1 una opci\xF3n"),o(),n(9,"option",29),l(10,"Galeno"),o(),n(11,"option",30),l(12,"Swiss Medical"),o(),n(13,"option",31),l(14,"OSDE"),o()()()()}if(a&2){let e=c(2);s(6),m("ngModel",e.obraSocial)}}function ne(a,_){if(a&1&&(n(0,"option",35),l(1),o()),a&2){let e=_.$implicit;g("value",e),s(),M(e)}}function oe(a,_){if(a&1){let e=b();n(0,"fieldset")(1,"legend"),l(2,"Datos del Especialista"),o(),n(3,"div",10)(4,"label"),l(5,"Especialidad:"),o(),n(6,"select",32),f("ngModelChange",function(t){d(e);let i=c(2);return u(i.especialidadSeleccionada,t)||(i.especialidadSeleccionada=t),p(t)}),n(7,"option",28),l(8,"Seleccion\xE1 una opci\xF3n"),o(),C(9,ne,2,2,"option",33),o(),n(10,"input",34),f("ngModelChange",function(t){d(e);let i=c(2);return u(i.nuevaEspecialidad,t)||(i.nuevaEspecialidad=t),p(t)}),o()()()}if(a&2){let e=c(2);s(6),m("ngModel",e.especialidadSeleccionada),s(3),g("ngForOf",e.especialidades),s(),m("ngModel",e.nuevaEspecialidad)}}function re(a,_){if(a&1&&(n(0,"div",36),l(1),o()),a&2){let e=c(2);s(),M(e.errorMessage)}}function ae(a,_){if(a&1&&(n(0,"div",37),l(1),o()),a&2){let e=c(2);s(),M(e.successMessage)}}function se(a,_){if(a&1){let e=b();n(0,"form",9),h("ngSubmit",function(){d(e);let t=c();return p(t.register())}),n(1,"fieldset")(2,"legend"),l(3,"Datos Generales"),o(),n(4,"div",10)(5,"input",11),f("ngModelChange",function(t){d(e);let i=c();return u(i.nombre,t)||(i.nombre=t),p(t)}),o(),n(6,"input",12),f("ngModelChange",function(t){d(e);let i=c();return u(i.apellido,t)||(i.apellido=t),p(t)}),o(),n(7,"input",13),f("ngModelChange",function(t){d(e);let i=c();return u(i.edad,t)||(i.edad=t),p(t)}),o(),n(8,"input",14),f("ngModelChange",function(t){d(e);let i=c();return u(i.dni,t)||(i.dni=t),p(t)}),o()()(),C(9,ie,15,1,"fieldset",15)(10,oe,11,3,"fieldset",15),n(11,"fieldset")(12,"legend"),l(13,"Acceso"),o(),n(14,"div",10)(15,"input",16),f("ngModelChange",function(t){d(e);let i=c();return u(i.username,t)||(i.username=t),p(t)}),o(),n(16,"input",17),f("ngModelChange",function(t){d(e);let i=c();return u(i.password,t)||(i.password=t),p(t)}),o(),n(17,"label"),l(18),o(),n(19,"input",18),h("change",function(t){d(e);let i=c();return p(i.onFilesSelected(t))}),o()(),n(20,"div",19)(21,"re-captcha",20),h("resolved",function(t){d(e);let i=c();return p(i.onCaptchaResolved(t))}),o()(),n(22,"div",21)(23,"button",22),h("click",function(){d(e);let t=c();return p(t.tipoUsuario="")}),l(24,"Volver"),o()()(),n(25,"div",21)(26,"button",23),l(27,"Registrar"),o(),C(28,re,2,1,"div",24)(29,ae,2,1,"div",25),n(30,"button",26),l(31,"Ir al Login"),o()()()}if(a&2){let e=c();s(5),m("ngModel",e.nombre),s(),m("ngModel",e.apellido),s(),m("ngModel",e.edad),s(),m("ngModel",e.dni),s(),g("ngIf",e.tipoUsuario==="paciente"),s(),g("ngIf",e.tipoUsuario==="especialista"),s(5),m("ngModel",e.username),s(),m("ngModel",e.password),s(2),I("Seleccionar ",e.tipoUsuario==="paciente"?"2 im\xE1genes":"1 imagen"," de perfil"),s(),g("multiple",e.tipoUsuario==="paciente"),s(4),g("disabled",e.loading),s(3),g("disabled",e.loading||!e.captchaToken),s(2),g("ngIf",e.errorMessage),s(),g("ngIf",e.successMessage),s(),g("disabled",e.loading)}}function le(a,_){a&1&&(n(0,"div",38),w(1,"div",39),o())}var P=Z(E.apiUrl,E.publicAnonKey),be=(()=>{class a{constructor(e){this.router=e,this.username="",this.password="",this.tipoUsuario="",this.nombre="",this.apellido="",this.edad=null,this.dni="",this.obraSocial="",this.especialidadSeleccionada="",this.nuevaEspecialidad="",this.imagenes=[],this.captchaToken=null,this.errorMessage=null,this.successMessage=null,this.loading=!1,this.especialidades=["Cardiolog\xEDa","Pediatr\xEDa","Traumatolog\xEDa","Dermatolog\xEDa"]}onCaptchaResolved(e){e&&e.trim()!==""?this.captchaToken=e:this.captchaToken=null}setTipoUsuario(e){this.tipoUsuario=e}register(){return S(this,null,function*(){if(this.errorMessage=null,this.successMessage=null,!this.username||!this.password||!this.tipoUsuario){this.errorMessage="Completa todos los campos obligatorios.";return}if(!this.captchaToken||this.captchaToken.trim()===""){this.errorMessage="Por favor, complet\xE1 el captcha.",this.recaptcha.reset();return}this.loading=!0;try{let{data:e,error:r}=yield P.auth.signUp({email:this.username,password:this.password});if(r){this.errorMessage=this.translateError(r.message),this.loading=!1,this.recaptcha.reset();return}if(!e.user){this.errorMessage="No se pudo crear el usuario.",this.loading=!1,this.recaptcha.reset();return}let t=yield this.uploadImages();if(t===null){this.errorMessage="Error al subir im\xE1genes.",this.loading=!1,this.recaptcha.reset();return}let i=[];if(this.tipoUsuario==="especialista"){this.especialidadSeleccionada&&i.push(this.especialidadSeleccionada);let v=this.nuevaEspecialidad.trim();v&&!i.includes(v)&&i.push(v)}let x={id:e.user.id,nombre:this.nombre,apellido:this.apellido,edad:this.edad,dni:this.dni,email:this.username,tipo_usuario:this.tipoUsuario,imagenes:t,confirmado:!1,created_at:new Date().toISOString()};this.tipoUsuario==="paciente"?x.obra_social=this.obraSocial:this.tipoUsuario==="especialista"&&(x.especialidad=i);let{error:ee}=yield P.from("usuarios").insert([x]);if(ee){this.errorMessage="Error al guardar los datos del usuario.",this.loading=!1,this.recaptcha.reset();return}this.successMessage=this.tipoUsuario==="especialista"?"Se registr\xF3 correctamente como especialista. Por favor, confirme su correo electr\xF3nico. Posteriormente, un administrador deber\xE1 validar su registro para poder acceder al sistema.":"Se registr\xF3 correctamente como paciente. Por favor, confirme su correo electr\xF3nico para completar el proceso.",this.username="",this.password="",this.nombre="",this.apellido="",this.edad=null,this.dni="",this.obraSocial="",this.especialidadSeleccionada="",this.nuevaEspecialidad="",this.imagenes=[],this.captchaToken=null,this.recaptcha.reset()}catch(e){this.errorMessage=e.message||"Error inesperado.",this.recaptcha.reset()}finally{this.loading=!1}})}uploadImages(){return S(this,null,function*(){if(!this.imagenes.length)return[];let e=[];for(let r of this.imagenes){let t=`users/${Date.now()}-${r.name}`,{data:i,error:x}=yield P.storage.from("images").upload(t,r,{upsert:!1});if(x)return console.error("Error al subir imagen:",x.message),null;e.push(i.path)}return e})}onFilesSelected(e){this.imagenes=Array.from(e.target.files)}translateError(e){let r={"Email already registered":"El correo electr\xF3nico ya est\xE1 registrado.","Invalid email":"El correo electr\xF3nico no es v\xE1lido.","Password too weak":"La contrase\xF1a es demasiado d\xE9bil.","Invalid password":"La contrase\xF1a no es v\xE1lida.","Invalid credentials":"Credenciales inv\xE1lidas.","Email not confirmed":"El correo electr\xF3nico no ha sido confirmado."};return e.toLowerCase().includes("user already registered")||e.toLowerCase().includes("email already registered")?"El correo electr\xF3nico ya est\xE1 registrado.":r[e]||"Ocurri\xF3 un error inesperado. Por favor, intenta de nuevo."}static{this.\u0275fac=function(r){return new(r||a)(V(F))}}static{this.\u0275cmp=O({type:a,selectors:[["app-register"]],viewQuery:function(r,t){if(r&1&&R(y,5),r&2){let i;k(i=T())&&(t.recaptcha=i.first)}},standalone:!0,features:[W],decls:6,vars:3,consts:[[1,"register-container"],[1,"registro"],["class","user-type-selector",4,"ngIf"],["class","form",3,"ngSubmit",4,"ngIf"],["class","loading-overlay",4,"ngIf"],[1,"user-type-selector"],[1,"user-type-button",3,"click"],["src","assets/paciente.png","alt","Paciente"],["src","assets/especialista.png","alt","Especialista"],[1,"form",3,"ngSubmit"],[1,"form-group"],["type","text","name","nombre","placeholder","Nombre",1,"register-input",3,"ngModelChange","ngModel"],["type","text","name","apellido","placeholder","Apellido",1,"register-input",3,"ngModelChange","ngModel"],["type","number","name","edad","placeholder","Edad",1,"register-input",3,"ngModelChange","ngModel"],["type","text","name","dni","placeholder","DNI",1,"register-input",3,"ngModelChange","ngModel"],[4,"ngIf"],["type","email","name","email","placeholder","Email","required","",1,"register-input",3,"ngModelChange","ngModel"],["type","password","name","password","placeholder","Contrase\xF1a","required","",1,"register-input",3,"ngModelChange","ngModel"],["type","file",1,"register-input",3,"change","multiple"],[1,"captcha-container"],["siteKey","6LeuL2MrAAAAAIjNfAG0qcfH8x1IdsElq7tdVHyB",3,"resolved"],[1,"volver-container"],["type","button",1,"btn","volver-btn",3,"click","disabled"],["type","submit",1,"btn","volver-btn",3,"disabled"],["class","error-message",4,"ngIf"],["class","success-message",4,"ngIf"],["routerLink","/login",1,"btn","volver-btn",3,"disabled"],["name","obraSocial","required","",1,"register-input",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],["value","Galeno"],["value","Swiss Medical"],["value","OSDE"],["name","especialidadSeleccionada",1,"register-input",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","text","name","nuevaEspecialidad","placeholder","Nueva especialidad (opcional)",1,"register-input",3,"ngModelChange","ngModel"],[3,"value"],[1,"error-message"],[1,"success-message"],[1,"loading-overlay"],[1,"spinner"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"h3",1),l(2,"Registro"),o(),C(3,te,9,0,"div",2)(4,se,32,15,"form",3)(5,le,2,0,"div",4),o()),r&2&&(s(3),g("ngIf",!t.tipoUsuario),s(),g("ngIf",t.tipoUsuario),s(),g("ngIf",t.loading))},dependencies:[Y,G,K,J,D,Q,H,B,j,X,z,q,A,N,L,U,$,y],styles:[`.register-container[_ngcontent-%COMP%]{background-color:#ccc8ad;background-image:url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M 0 0 L 40 40 M 40 0 L 0 40' stroke='%23c5e1a5' stroke-width='0.5'/%3E%3C/svg%3E");background-repeat:repeat;background-size:40px 40px;min-height:100vh;padding:30px;font-family:Roboto,sans-serif;display:flex;flex-direction:column;align-items:center}h3[_ngcontent-%COMP%]{font-size:2.5rem;color:#1b5e20;text-shadow:0 1px 2px rgba(0,0,0,.2);text-align:center;margin-bottom:30px}form.form[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #a5d6a7;border-radius:8px;padding:25px;width:100%;max-width:600px;box-shadow:0 0 10px #0000000d}fieldset[_ngcontent-%COMP%]{border:1px solid #a5d6a7;border-radius:6px;padding:20px;margin-bottom:20px}legend[_ngcontent-%COMP%]{font-weight:700;color:#2e7d32;padding:0 10px}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:14px}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:10px 14px;border:1px solid #a5d6a7;border-radius:6px;background-color:#fff;color:#1b5e20;font-size:1rem;transition:border-color .3s ease}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{border-color:#4caf50;outline:none;box-shadow:0 0 4px #81c784}label[_ngcontent-%COMP%]{font-weight:500;color:#1b5e20}button[type=button][_ngcontent-%COMP%], .btn-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#a5d6a7;border:1px solid #2e7d32;color:#2e7d32;padding:10px 20px;border-radius:6px;font-weight:700;text-transform:uppercase;cursor:pointer;transition:background-color .3s ease;margin-top:10px;align-self:center}button[_ngcontent-%COMP%]:hover{background-color:#81c784;color:#fff}.btn-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:20px;margin-top:20px;flex-wrap:wrap}.error-message[_ngcontent-%COMP%]{color:#d32f2f;background-color:#fce4ec;border:1px solid #f8bbd0;padding:10px 16px;margin-top:10px;margin-left:5px;border-radius:6px;max-width:400px;text-align:center}.success-message[_ngcontent-%COMP%]{color:#2e7d32;background-color:#dcedc8;border:1px solid #a5d6a7;padding:10px 16px;margin-top:10px;margin-left:5px;border-radius:6px;max-width:400px;text-align:center}.loading-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#1b5e2040;display:flex;justify-content:center;align-items:center;z-index:1000}.spinner[_ngcontent-%COMP%]{border:6px solid #c8e6c9;border-top:6px solid #1b5e20;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.user-type-selector[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:20px;margin-bottom:30px}.user-type-button[_ngcontent-%COMP%]{background-color:transparent;border:2px solid #a5d6a7;border-radius:50%;padding:15px;width:140px;height:140px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:background-color .3s ease}.user-type-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:60px;height:60px;margin-bottom:8px}.user-type-button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1rem;color:#2e7d32;font-weight:700}.user-type-button[_ngcontent-%COMP%]:hover{background-color:#dcedc8}.volver-container[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:20px 0}.volver-btn[_ngcontent-%COMP%]{background-color:#c8e6c9;border:2px solid #81c784;margin-left:5px;color:#2e7d32;font-weight:700;padding:10px 20px;border-radius:10px;cursor:pointer;transition:background-color .3s ease}.volver-btn[_ngcontent-%COMP%]:hover{background-color:#a5d6a7}.captcha-container[_ngcontent-%COMP%]{margin-top:15px;margin-bottom:20px;display:flex;justify-content:center}`]})}}return a})();export{be as RegisterComponent};
