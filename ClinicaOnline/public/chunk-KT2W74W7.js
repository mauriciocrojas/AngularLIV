import{a as Y}from"./chunk-I3VI4AVH.js";import{b as W,e as G,h as H,i as J,j as K,p as Q}from"./chunk-GS6HGKLI.js";import{$ as z,B as w,Ba as B,D as o,E as M,Ia as R,L as g,Ma as X,N as l,Na as T,O as I,P as s,Q as a,R as x,S as V,T as j,U as f,V as _,W as d,aa as p,ba as O,da as E,ea as F,fa as N,ga as D,ha as q,ja as A,na as $,o as y,s as u,t as m,u as P,ua as L,v as k,va as U}from"./chunk-DKADGSXX.js";import"./chunk-SZXJF6TW.js";import{i as b}from"./chunk-P2VZOJAX.js";function ee(t,c){if(t&1){let e=f();s(0,"button",2),_("click",function(){u(e);let i=d();return m(i.volverPaso())}),p(1,"\u2190 Volver paso"),a()}}function ie(t,c){if(t&1&&(s(0,"option",15),p(1),a()),t&2){let e=c.$implicit;l("value",e.id),o(),E("",e.nombre," ",e.apellido,"")}}function te(t,c){if(t&1){let e=f();s(0,"div",10)(1,"label",11),p(2,"Seleccionar paciente:"),a(),s(3,"select",12),q("ngModelChange",function(i){u(e);let r=d();return D(r.pacienteSeleccionado,i)||(r.pacienteSeleccionado=i),m(i)}),s(4,"option",13),p(5,"-- Seleccionar paciente --"),a(),g(6,ie,2,3,"option",14),a()()}if(t&2){let e=d();o(3),N("ngModel",e.pacienteSeleccionado),o(3),l("ngForOf",e.pacientes)}}function ne(t,c){if(t&1){let e=f();s(0,"button",18),_("click",function(){let i=u(e).$implicit,r=d(2);return m(r.seleccionarEspecialidad(i))}),x(1,"img",19),a()}if(t&2){let e=c.$implicit,n=d(2);o(),l("src",n.imagenesEspecialidades[e]||"assets/especialidades/defecto.png",w)}}function oe(t,c){if(t&1&&(s(0,"div",16),g(1,ne,2,1,"button",17),a()),t&2){let e=d();o(),l("ngForOf",e.especialidades)}}function ae(t,c){if(t&1&&(V(0),x(1,"img",23),j()),t&2){let e=d().$implicit;o(),l("src","https://vjthgijqloomeatknoxz.supabase.co/storage/v1/object/public/images/"+e.imagenes[0],w)}}function re(t,c){t&1&&x(0,"img",24)}function se(t,c){if(t&1){let e=f();s(0,"div",21),_("click",function(){let i=u(e).$implicit,r=d(2);return m(r.seleccionarEspecialista(i))}),s(1,"span"),p(2),a(),g(3,ae,2,1,"ng-container",22)(4,re,1,0,"ng-template",null,0,$),a()}if(t&2){let e=c.$implicit,n=z(5);o(2),E("",e.nombre," ",e.apellido,""),o(),l("ngIf",(e.imagenes==null?null:e.imagenes.length)>0)("ngIfElse",n)}}function ce(t,c){if(t&1&&(s(0,"div",16),g(1,se,6,4,"div",20),a()),t&2){let e=d();o(),l("ngForOf",e.especialistas)}}function le(t,c){if(t&1){let e=f();s(0,"button",26),_("click",function(){let i=u(e).$implicit,r=d(2);return m(r.disponibilidadSeleccionada=i.id)}),p(1),a()}if(t&2){let e=c.$implicit,n=d(2);I("seleccionado",e.id===n.disponibilidadSeleccionada),o(),F(" ",e.fecha==null?null:e.fecha.split("-").reverse().join("/")," ",e.hora_inicio==null?null:e.hora_inicio.slice(0,5)," - ",e.hora_fin==null?null:e.hora_fin.slice(0,5)," ")}}function de(t,c){if(t&1&&(s(0,"div",16),g(1,le,2,5,"button",25),a()),t&2){let e=d();o(),l("ngForOf",e.disponibilidad)}}function pe(t,c){if(t&1){let e=f();s(0,"div",10)(1,"button",27),_("click",function(){u(e);let i=d();return m(i.solicitar())}),p(2,"Solicitar Turno"),a()()}}function ue(t,c){if(t&1&&(s(0,"div",28),p(1),a()),t&2){let e=d();o(),O(e.success)}}function me(t,c){if(t&1&&(s(0,"div",29),p(1),a()),t&2){let e=d();o(),O(e.error)}}var h=X(T.apiUrl,T.publicAnonKey),we=(()=>{class t{constructor(e,n){this.router=e,this.authService=n,this.usuario={},this.especialidades=[],this.especialistas=[],this.disponibilidad=[],this.especialistaSeleccionado="",this.disponibilidadSeleccionada="",this.filtroEspecialidad="",this.pacientes=[],this.pacienteSeleccionado="",this.error="",this.success="",this.imagenesEspecialidades={Cardiolog\u00EDa:"assets/especialidades/cardiologia.png",Dermatolog\u00EDa:"assets/especialidades/dermatologia.png",Ginecolog\u00EDa:"assets/especialidades/defecto.png",Pediatr\u00EDa:"assets/especialidades/defecto.png",Neurolog\u00EDa:"assets/especialidades/neurologia.png",Traumatolog\u00EDa:"assets/especialidades/traumatologia.png",Otorrinolaringolog\u00EDa:"assets/especialidades/defecto.png",Oftalmolog\u00EDa:"assets/especialidades/defecto.png",Odontolog\u00EDa:"assets/especialidades/defecto.png"}}ngOnInit(){return b(this,null,function*(){if(this.usuario=yield this.authService.getUser(),!this.usuario)return;let{data:e,error:n}=yield h.from("usuarios").select("especialidad").eq("tipo_usuario","especialista");if(n){this.error="Error al cargar especialidades: "+n.message;return}if(this.especialidades=Array.from(new Set((e||[]).flatMap(i=>{if(!i.especialidad)return[];try{return JSON.parse(i.especialidad)}catch{return[i.especialidad]}}).filter(i=>!!i))),this.usuario.tipo_usuario==="administrador"){let{data:i,error:r}=yield h.from("usuarios").select("id, nombre, apellido").eq("tipo_usuario","paciente");if(r){this.error="Error al cargar pacientes: "+r.message;return}this.pacientes=i||[]}this.limpiarMensajes()})}filtrarEspecialistas(){return b(this,null,function*(){this.limpiarMensajes();let{data:e,error:n}=yield h.from("usuarios").select("id, nombre, apellido, especialidad, imagenes").eq("tipo_usuario","especialista").not("especialidad","is",null);if(n){this.error="Error al buscar especialistas: "+n.message;return}this.especialistas=(e||[]).filter(i=>{try{let r=JSON.parse(i.especialidad);return Array.isArray(r)?r.includes(this.filtroEspecialidad):!1}catch{return i.especialidad===this.filtroEspecialidad}}),this.error=this.especialistas.length===0?"No se encontraron especialistas para la especialidad seleccionada.":""})}cargarDisponibilidad(){return b(this,null,function*(){this.limpiarMensajes();let e=new Date().toISOString().split("T")[0],{data:n,error:i}=yield h.from("disponibilidad_especialista").select("*").eq("especialista_id",this.especialistaSeleccionado).eq("especialidad",this.filtroEspecialidad).gte("fecha",e).order("fecha",{ascending:!0}).order("hora_inicio",{ascending:!0});if(i){this.error="Error al cargar disponibilidad: "+i.message,this.disponibilidad=[];return}let r=n||[],{data:v,error:C}=yield h.from("turnos").select("id_disponibilidad").eq("especialista_id",this.especialistaSeleccionado).eq("especialidad",this.filtroEspecialidad).not("estado","eq","rechazado").not("id_disponibilidad","is",null);if(C){this.error="Error al verificar turnos existentes: "+C.message,this.disponibilidad=[];return}let Z=new Set((v||[]).map(S=>S.id_disponibilidad));this.disponibilidad=r.filter(S=>!Z.has(S.id)),this.error=this.disponibilidad.length===0?"No hay turnos disponibles.":""})}solicitar(){return b(this,null,function*(){if(this.limpiarMensajes(),!this.disponibilidadSeleccionada){this.error="Por favor, selecciona un turno disponible.";return}let e=this.disponibilidad.find(C=>C.id===this.disponibilidadSeleccionada);if(!e){this.error="El turno seleccionado no es v\xE1lido.";return}let n=`${e.fecha}T${e.hora_inicio}`,i=this.usuario.tipo_usuario==="administrador"?this.pacienteSeleccionado:this.usuario.id;if(!i){this.error="Seleccion\xE1 un paciente para continuar.";return}let r={paciente_id:i,especialista_id:e.especialista_id,especialidad:e.especialidad,fecha_hora:n,estado:"pendiente",creado_en:new Date().toISOString(),id_disponibilidad:e.id},{error:v}=yield h.from("turnos").insert([r]);v?(this.error=v.message,this.success=""):(this.success="Turno solicitado con \xE9xito.",this.resetear())})}seleccionarEspecialidad(e){this.limpiarMensajes(),this.filtroEspecialidad=e,this.filtrarEspecialistas()}seleccionarEspecialista(e){this.limpiarMensajes(),this.especialistaSeleccionado=e.id,this.cargarDisponibilidad()}volverPaso(){this.limpiarMensajes(),this.disponibilidadSeleccionada?this.disponibilidadSeleccionada="":this.especialistaSeleccionado?(this.especialistaSeleccionado="",this.disponibilidad=[]):this.filtroEspecialidad&&(this.filtroEspecialidad="",this.especialistas=[])}volverAtras(){this.limpiarMensajes(),this.router.navigate(["/"])}resetear(){this.limpiarMensajes(),this.filtroEspecialidad="",this.especialistaSeleccionado="",this.disponibilidadSeleccionada="",this.disponibilidad=[],this.especialistas=[],this.pacienteSeleccionado=""}limpiarMensajes(){this.error="",this.success=""}static{this.\u0275fac=function(n){return new(n||t)(M(R),M(Y))}}static{this.\u0275cmp=y({type:t,selectors:[["app-solicitar-turnos"]],standalone:!0,features:[A],decls:16,vars:8,consts:[["defaultImg",""],[1,"turnos-container"],[1,"btn-volver",3,"click"],["viewBox","0 0 24 24"],["points","15 18 9 12 15 6"],["class","btn-volver",3,"click",4,"ngIf"],["class","campo",4,"ngIf"],["class","seleccion-grid",4,"ngIf"],["class","success",4,"ngIf"],["class","error",4,"ngIf"],[1,"campo"],["for","paciente"],["id","paciente",3,"ngModelChange","ngModel"],["disabled","","selected","","value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"seleccion-grid"],["class","boton-img",3,"click",4,"ngFor","ngForOf"],[1,"boton-img",3,"click"],["alt","Especialidad",3,"src"],["class","boton-profesional",3,"click",4,"ngFor","ngForOf"],[1,"boton-profesional",3,"click"],[4,"ngIf","ngIfElse"],["alt","Especialista",3,"src"],["src","assets/default-user.png","alt","Especialista"],["class","boton-turno",3,"seleccionado","click",4,"ngFor","ngForOf"],[1,"boton-turno",3,"click"],[1,"btn",3,"click"],[1,"success"],[1,"error"]],template:function(n,i){n&1&&(s(0,"body")(1,"div",1)(2,"button",2),_("click",function(){return i.volverAtras()}),P(),s(3,"svg",3),x(4,"polyline",4),a(),p(5," Volver atr\xE1s "),a(),k(),s(6,"h2"),p(7,"Solicitar Turno"),a(),g(8,ee,2,0,"button",5)(9,te,7,2,"div",6)(10,oe,2,1,"div",7)(11,ce,2,1,"div",7)(12,de,2,1,"div",7)(13,pe,3,0,"div",6)(14,ue,2,1,"div",8)(15,me,2,1,"div",9),a()()),n&2&&(o(8),l("ngIf",i.filtroEspecialidad||i.especialistaSeleccionado),o(),l("ngIf",(i.usuario==null?null:i.usuario.tipo_usuario)==="administrador"),o(),l("ngIf",!i.filtroEspecialidad),o(),l("ngIf",i.filtroEspecialidad&&!i.especialistaSeleccionado),o(),l("ngIf",i.especialistaSeleccionado&&i.disponibilidad.length>0),o(),l("ngIf",i.disponibilidadSeleccionada),o(),l("ngIf",i.success),o(),l("ngIf",i.error))},dependencies:[B,L,U,Q,J,K,H,W,G],styles:[`body[_ngcontent-%COMP%], html[_ngcontent-%COMP%]{background-color:#ccc8ad;background-image:url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M 0 0 L 40 40 M 40 0 L 0 40' stroke='%23c5e1a5' stroke-width='0.5'/%3E%3C/svg%3E");background-repeat:repeat;background-size:40px 40px;min-height:100vh;padding:30px;font-family:Roboto,sans-serif;display:flex;flex-direction:column;align-items:center;color:#1b5e20}.turnos-container[_ngcontent-%COMP%]{background-color:#fff;color:#1b5e20;padding:40px 20px;border-radius:12px;box-shadow:0 6px 15px #00000026;width:100%;max-width:480px;box-sizing:border-box;max-height:90vh;overflow-y:auto;display:flex;flex-direction:column;align-items:center}.turnos-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;color:#0a5c0a;margin-bottom:2rem;font-weight:700;font-size:1.8rem}.campo[_ngcontent-%COMP%]{margin-bottom:1.6rem;width:100%}label[_ngcontent-%COMP%]{display:block;margin-bottom:.6rem;font-weight:600;font-size:1rem;color:#145214}select[_ngcontent-%COMP%], input[type=time][_ngcontent-%COMP%]{width:100%;padding:.6rem 1rem;font-size:1.05rem;border:1.5px solid #a5d6a7;border-radius:8px;background-color:#fff;color:#1b5e20;transition:border-color .3s ease;box-sizing:border-box}select[_ngcontent-%COMP%]:focus, input[type=time][_ngcontent-%COMP%]:focus{outline:none;border-color:#0a5c0a;box-shadow:0 0 6px #8bc34aaa}.fecha-selectores[_ngcontent-%COMP%]{display:flex;gap:1rem}.fecha-selectores[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{flex:1}.btn[_ngcontent-%COMP%]{display:block;width:100%;padding:.75rem;font-size:1.1rem;background-color:#0a5c0a;color:#fff;border:none;border-radius:10px;cursor:pointer;transition:background-color .25s ease,transform .15s ease;font-weight:600;box-shadow:0 3px 5px #0a5c0a99}.btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#087108;transform:scale(1.03);box-shadow:0 5px 12px #0a5c0aaa}.btn[_ngcontent-%COMP%]:disabled{background-color:#a5d6a7;cursor:default;box-shadow:none;color:#5a7a50}.success[_ngcontent-%COMP%], .error[_ngcontent-%COMP%]{margin-top:1.2rem;padding:.7rem 1rem;border-radius:8px;font-weight:600;font-size:1rem;width:100%;box-sizing:border-box;text-align:center}.success[_ngcontent-%COMP%]{color:#1b6e1b;background:#d9f4d9;border:1.5px solid #70a870}.error[_ngcontent-%COMP%]{color:#912323;background:#fcdede;border:1.5px solid #c94a4a}select[_ngcontent-%COMP%]   option[disabled][selected][_ngcontent-%COMP%]{color:#999}@media (max-width: 400px){.fecha-selectores[_ngcontent-%COMP%]{flex-direction:column}.fecha-selectores[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{flex:none;width:100%}}.btn-volver[_ngcontent-%COMP%]{align-self:flex-start;background-color:transparent;border:none;color:#0a5c0a;font-weight:600;font-size:1rem;cursor:pointer;margin-bottom:1.5rem;display:flex;align-items:center;gap:6px;padding:0;transition:color .2s ease}.btn-volver[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;fill:none}.seleccion-grid[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;gap:1rem;margin-bottom:2rem}.boton-img[_ngcontent-%COMP%], .boton-profesional[_ngcontent-%COMP%], .boton-turno[_ngcontent-%COMP%]{border:none;border-radius:12px;cursor:pointer;background-color:#e8f5e9;box-shadow:0 3px 6px #0000001a;transition:transform .2s ease,box-shadow .2s ease}.boton-img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;height:80px;object-fit:cover;border-radius:10px}.boton-profesional[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:120px}.boton-profesional[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:90px;object-fit:cover;border-radius:8px;margin-top:6px}.boton-profesional[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;color:#1b5e20;text-align:center}.boton-turno[_ngcontent-%COMP%]{padding:.6rem 1rem;font-weight:600;font-size:1rem;background-color:#dcedc8;color:#1b5e20;min-width:100px}.boton-turno.seleccionado[_ngcontent-%COMP%]{background-color:#a5d6a7;border:2px solid #388e3c}.btn-volver[_ngcontent-%COMP%]{background-color:transparent;border:none;color:#0a5c0a;font-weight:600;font-size:1rem;cursor:pointer;margin-bottom:1rem;display:flex;align-items:center;gap:4px;padding:0;transition:color .2s ease}.btn-volver[_ngcontent-%COMP%]:hover{color:#087108}`]})}}return t})();export{we as SolicitarTurnosComponent};
