import{p as q}from"./chunk-GS6HGKLI.js";import{$ as w,B as k,Ba as A,C as S,D as a,Ja as U,L as p,La as D,Ma as B,N as l,Na as E,P as r,Q as n,R as x,U as h,V as C,W as d,X as F,aa as i,ba as P,ca as m,da as M,ja as z,ka as b,la as R,ma as O,na as y,o as T,s as u,t as v,ta as N,ua as V,va as j,xa as H,ya as $}from"./chunk-DKADGSXX.js";import"./chunk-SZXJF6TW.js";import{i as f}from"./chunk-P2VZOJAX.js";function K(t,s){t&1&&(r(0,"div",7),x(1,"div",8),n())}function Y(t,s){if(t&1){let e=h();r(0,"div",14)(1,"div",15),x(2,"img",16),r(3,"button",17),C("click",function(){let c=u(e).$implicit,_=d(3);return v(_.selectPatient(c))}),x(4,"i",18),n()(),r(5,"div",19)(6,"h3"),i(7),n(),r(8,"p"),i(9),n()()()}if(t&2){let e=s.$implicit,o=d(3);a(2),F("alt","Foto de ",e.nombre,""),l("src",o.getPatientImageUrl(e),k),a(5),M("",e.nombre," ",e.apellido,""),a(2),P(e.email)}}function X(t,s){if(t&1&&(r(0,"div",12),p(1,Y,10,6,"div",13),n()),t&2){let e=d(2);a(),l("ngForOf",e.pacientes)}}function G(t,s){t&1&&(r(0,"p",20),i(1,"No tienes pacientes registrados que hayas atendido."),n())}function J(t,s){if(t&1&&(r(0,"div")(1,"p")(2,"strong"),i(3,"Calificaci\xF3n del paciente:"),n(),i(4),n()()),t&2){let e=d().$implicit;a(4),m(" ",e.calificacion_paciente," estrellas")}}function Q(t,s){if(t&1&&(r(0,"div")(1,"p")(2,"strong"),i(3,"Comentario del paciente:"),n(),i(4),n()()),t&2){let e=d().$implicit;a(4),m(" ",e.comentario_paciente,"")}}function W(t,s){if(t&1){let e=h();r(0,"div")(1,"button",29),C("click",function(){u(e);let c=d().$implicit,_=d(4);return v(_.viewReview(c))}),i(2,"Ver Mi Rese\xF1a"),n()()}}function Z(t,s){t&1&&(r(0,"div")(1,"p",30),i(2,"A\xFAn no has cargado la rese\xF1a de este turno."),n()())}function ee(t,s){if(t&1&&(r(0,"div",27)(1,"h4"),i(2),b(3,"date"),n(),r(4,"p")(5,"strong"),i(6,"Especialidad:"),n(),i(7),n(),r(8,"p")(9,"strong"),i(10,"Estado:"),n(),r(11,"span",28),i(12),b(13,"titlecase"),n()(),p(14,J,5,1,"div",5)(15,Q,5,1,"div",5)(16,W,3,0,"div",5)(17,Z,3,0,"div",5),n()),t&2){let e=s.$implicit;a(2),P(O(3,8,e.fecha_hora,"dd/MM/yyyy HH:mm")),a(5),m(" ",e.especialidad,""),a(4),l("ngClass","status-"+e.estado),a(),P(R(13,11,e.estado)),a(2),l("ngIf",e.estado==="realizado"&&e.calificacion_paciente),a(),l("ngIf",e.comentario_paciente),a(),l("ngIf",e.resena_especialista&&e.resena_especialista.trim()!==""),a(),l("ngIf",!(e.resena_especialista&&e.resena_especialista.trim()!=="")&&e.estado==="realizado")}}function te(t,s){if(t&1&&(r(0,"div",25),p(1,ee,18,13,"div",26),n()),t&2){let e=d(3);a(),l("ngForOf",e.selectedPatientTurns)}}function ne(t,s){t&1&&(r(0,"p",20),i(1,"No se encontraron turnos con este paciente para tu especialidad."),n())}function ie(t,s){if(t&1){let e=h();r(0,"div",21)(1,"h3"),i(2),n(),p(3,te,2,1,"div",22)(4,ne,2,0,"ng-template",null,1,y),r(6,"div",23)(7,"button",24),C("click",function(){u(e);let c=d(2);return v(c.clearSelectedPatient())}),i(8,"Volver a Pacientes"),n()()()}if(t&2){let e=w(5),o=d(2);a(2),M("Turnos de ",o.selectedPatient.nombre," ",o.selectedPatient.apellido,""),a(),l("ngIf",o.selectedPatientTurns.length>0)("ngIfElse",e)}}function oe(t,s){t&1&&(r(0,"div",23)(1,"button",31),i(2,"Volver al Inicio"),n()())}function ae(t,s){if(t&1&&(r(0,"div"),p(1,X,2,1,"div",9)(2,G,2,0,"ng-template",null,0,y)(4,ie,9,4,"div",10)(5,oe,3,0,"div",11),n()),t&2){let e=w(3),o=d();a(),l("ngIf",o.pacientes.length>0)("ngIfElse",e),a(3),l("ngIf",o.selectedPatient),a(),l("ngIf",!o.selectedPatient)}}function re(t,s){if(t&1&&(r(0,"li")(1,"strong"),i(2),n(),i(3),n()),t&2){let e=s.$implicit,o=d(2).$implicit;a(2),m("",e,":"),a(),m(" ",o.datos_dinamicos[e]," ")}}function se(t,s){if(t&1&&(r(0,"div")(1,"h5"),i(2,"Datos Adicionales:"),n(),r(3,"ul"),p(4,re,4,2,"li",39),n()()),t&2){let e=d().$implicit,o=d(3);a(4),l("ngForOf",o.getObjectKeys(e.datos_dinamicos))}}function ce(t,s){if(t&1&&(r(0,"div",38)(1,"p")(2,"strong"),i(3,"Altura:"),n(),i(4),n(),r(5,"p")(6,"strong"),i(7,"Peso:"),n(),i(8),n(),r(9,"p")(10,"strong"),i(11,"Temperatura:"),n(),i(12),n(),r(13,"p")(14,"strong"),i(15,"Presi\xF3n:"),n(),i(16),n(),p(17,se,5,1,"div",5),n()),t&2){let e=s.$implicit;a(4),m(" ",e.altura||"N/A",""),a(4),m(" ",e.peso||"N/A",""),a(4),m(" ",e.temperatura||"N/A",""),a(4),m(" ",e.presion||"N/A",""),a(),l("ngIf",e.datos_dinamicos)}}function le(t,s){if(t&1&&(r(0,"div")(1,"h4"),i(2,"Historia Cl\xEDnica Asociada:"),n(),p(3,ce,18,5,"div",37),n()),t&2){let e=d(2);a(3),l("ngForOf",e.selectedHistoriaClinica)}}function de(t,s){if(t&1){let e=h();r(0,"div",32)(1,"div",33)(2,"h3"),i(3),b(4,"date"),n(),r(5,"button",34),C("click",function(){u(e);let c=d();return v(c.closeReviewModal())}),i(6,"X"),n(),r(7,"div",35)(8,"p")(9,"strong"),i(10,"Paciente:"),n(),i(11),n(),r(12,"p")(13,"strong"),i(14,"Especialidad:"),n(),i(15),n(),r(16,"p")(17,"strong"),i(18,"Rese\xF1a:"),n()(),r(19,"p",36),i(20),n(),p(21,le,4,1,"div",5),n()()()}if(t&2){let e=d();a(3),m("Rese\xF1a del Turno del ",O(4,5,e.selectedTurnoForReview==null?null:e.selectedTurnoForReview.fecha_hora,"dd/MM/yyyy HH:mm"),""),a(8),m(" ",e.selectedPatientName,""),a(4),m(" ",e.selectedTurnoForReview==null?null:e.selectedTurnoForReview.especialidad,""),a(5),P((e.selectedTurnoForReview==null?null:e.selectedTurnoForReview.resena_especialista)||"No hay rese\xF1a disponible."),a(),l("ngIf",e.selectedHistoriaClinica.length>0)}}var g=B(E.apiUrl,E.publicAnonKey),he=(()=>{class t{constructor(){this.loading=!1,this.pacientes=[],this.specialistId=null,this.selectedPatient=null,this.selectedPatientTurns=[],this.selectedTurnoForReview=null,this.showReviewModal=!1,this.selectedHistoriaClinica=[],this.selectedPatientName=""}ngOnInit(){return f(this,null,function*(){this.loading=!0;try{let{data:{user:e},error:o}=yield g.auth.getUser();if(o){console.error("Error al obtener la sesi\xF3n del usuario:",o),this.loading=!1;return}e?(this.specialistId=e.id,yield this.loadPatientsForSpecialist()):(console.warn("No hay especialista logueado o sesi\xF3n de usuario no encontrada."),this.specialistId=null,this.loading=!1)}catch(e){console.error("Ocurri\xF3 un error inesperado durante la verificaci\xF3n de autenticaci\xF3n:",e),this.loading=!1}})}loadPatientsForSpecialist(){return f(this,null,function*(){if(!this.specialistId){this.loading=!1;return}this.loading=!0;try{let{data:e,error:o}=yield g.from("turnos").select("paciente_id").eq("especialista_id",this.specialistId).not("paciente_id","is",null);if(o){console.error("Error al obtener turnos para el especialista:",o),this.loading=!1;return}if(!e||e.length===0){this.pacientes=[],this.loading=!1;return}let c=[...new Set(e.map(L=>L.paciente_id))],{data:_,error:I}=yield g.from("usuarios").select("*").in("id",c).eq("tipo_usuario","paciente");if(I){console.error("Error al obtener pacientes:",I),this.loading=!1;return}this.pacientes=_}catch(e){console.error("Ocurri\xF3 un error inesperado al cargar pacientes:",e)}finally{this.loading=!1}})}selectPatient(e){return f(this,null,function*(){this.loading=!0,this.selectedPatient=e,this.selectedPatientTurns=[],this.selectedPatientName=`${e.nombre} ${e.apellido}`;try{let{data:o,error:c}=yield g.from("turnos").select("*").eq("paciente_id",e.id).eq("especialista_id",this.specialistId).order("fecha_hora",{ascending:!1});if(c){console.error("Error al cargar turnos del paciente seleccionado:",c);return}this.selectedPatientTurns=o||[]}catch(o){console.error("Error inesperado al seleccionar paciente:",o)}finally{this.loading=!1}})}clearSelectedPatient(){this.selectedPatient=null,this.selectedPatientTurns=[],this.selectedTurnoForReview=null,this.selectedHistoriaClinica=[],this.selectedPatientName=""}viewReview(e){return f(this,null,function*(){this.loading=!0,this.selectedTurnoForReview=e,this.selectedHistoriaClinica=[];try{if(e.resena_especialista&&e.resena_especialista.trim()!==""){let{data:o,error:c}=yield g.from("historias_clinicas").select("*").eq("turno_id",e.id);if(c){console.error("Error al obtener historias cl\xEDnicas para la rese\xF1a:",c);return}this.selectedHistoriaClinica=o||[]}else console.warn("El turno no tiene una rese\xF1a de especialista cargada o est\xE1 vac\xEDa.")}catch(o){console.error("Error inesperado al ver rese\xF1a:",o)}finally{this.loading=!1,this.showReviewModal=!0}})}closeReviewModal(){this.showReviewModal=!1,this.selectedTurnoForReview=null,this.selectedHistoriaClinica=[]}getObjectKeys(e){return Object.keys(e)}getPatientImageUrl(e){if(e.imagenes&&e.imagenes.length>0){let o=e.imagenes[0],{data:c}=g.storage.from("images").getPublicUrl(o);if(c?.publicUrl)return c.publicUrl}return"assets/default-user.png"}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275cmp=T({type:t,selectors:[["app-pacientes"]],standalone:!0,features:[z],decls:7,vars:3,consts:[["noPacientes",""],["noTurns",""],["rel","stylesheet","href",S`https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css`],[1,"pacientes-container"],["class","loading-overlay",4,"ngIf"],[4,"ngIf"],["class","modal-overlay",4,"ngIf"],[1,"loading-overlay"],[1,"spinner"],["class","patient-cards-grid",4,"ngIf","ngIfElse"],["class","selected-patient-details",4,"ngIf"],["class","btn-container",4,"ngIf"],[1,"patient-cards-grid"],["class","patient-card",4,"ngFor","ngForOf"],[1,"patient-card"],[1,"patient-image-container"],[1,"patient-image",3,"src","alt"],[1,"fav-button",3,"click"],[1,"fas","fa-eye"],[1,"patient-info"],[1,"mensaje"],[1,"selected-patient-details"],["class","turnos-list",4,"ngIf","ngIfElse"],[1,"btn-container"],[1,"primary-button",3,"click"],[1,"turnos-list"],["class","turno-item",4,"ngFor","ngForOf"],[1,"turno-item"],[3,"ngClass"],[1,"review-button",3,"click"],[1,"no-review-message"],["routerLink","/home",1,"primary-button"],[1,"modal-overlay"],[1,"modal-content"],[1,"modal-close-button",3,"click"],[1,"review-details"],[1,"review-text"],["class","historia-item-review",4,"ngFor","ngForOf"],[1,"historia-item-review"],[4,"ngFor","ngForOf"]],template:function(o,c){o&1&&(x(0,"link",2),r(1,"div",3)(2,"h2"),i(3,"Mis Pacientes Atendidos"),n(),p(4,K,2,0,"div",4)(5,ae,6,4,"div",5),n(),p(6,de,22,8,"div",6)),o&2&&(a(4),l("ngIf",c.loading),a(),l("ngIf",!c.loading),a(),l("ngIf",c.showReviewModal))},dependencies:[A,N,V,j,H,$,D,U,q],styles:[`.pacientes-container[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#ccc8ad;background-image:url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M 0 0 L 40 40 M 40 0 L 0 40' stroke='%23c5e1a5' stroke-width='0.5'/%3E%3C/svg%3E");background-repeat:repeat;padding:2rem;display:flex;flex-direction:column;align-items:center;min-height:100vh;box-sizing:border-box}.pacientes-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#2d6a4f;margin-bottom:2rem;text-align:center}.mensaje[_ngcontent-%COMP%]{margin:1rem 0;color:#0a3622;background:#d1e7dd;padding:.75rem 1rem;border-radius:.5rem;width:100%;max-width:800px;text-align:center}.patient-cards-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:1.5rem;width:100%;max-width:1200px;margin-bottom:2rem}.patient-card[_ngcontent-%COMP%]{background-color:#fffbf0;border-radius:.8rem;box-shadow:0 4px 12px #0000001a;overflow:hidden;text-align:center;padding-bottom:1rem;transition:transform .2s ease,box-shadow .2s ease;display:flex;flex-direction:column;align-items:center;justify-content:space-between}.patient-card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 6px 16px #00000026}.patient-image-container[_ngcontent-%COMP%]{position:relative;width:100%;padding-top:100%;overflow:hidden;border-bottom:1px solid #eee;display:flex;justify-content:center;align-items:center}.patient-image[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;border-radius:.8rem .8rem 0 0}.fav-button[_ngcontent-%COMP%]{position:absolute;bottom:.75rem;right:.75rem;background-color:#52b788;color:#fff;border:none;border-radius:50%;width:45px;height:45px;display:flex;justify-content:center;align-items:center;font-size:1.2rem;cursor:pointer;box-shadow:0 2px 8px #0003;transition:background-color .2s ease,transform .2s ease;z-index:1}.fav-button[_ngcontent-%COMP%]:hover{background-color:#40916c;transform:scale(1.05)}.patient-info[_ngcontent-%COMP%]{padding:1rem;width:100%}.patient-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;color:#2d6a4f;font-size:1.2rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.patient-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#555;font-size:.9rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.selected-patient-details[_ngcontent-%COMP%]{background-color:#fffbf0;border-radius:.8rem;box-shadow:0 4px 12px #0000001a;padding:2rem;margin-top:2rem;width:100%;max-width:900px}.selected-patient-details[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#2d6a4f;margin-bottom:1.5rem;text-align:center;font-size:1.8rem}.turnos-list[_ngcontent-%COMP%]{display:grid;gap:1rem}.turno-item[_ngcontent-%COMP%]{background-color:#e6f1ec;border:1px solid #74c69d;border-radius:.5rem;padding:1rem;position:relative;box-shadow:0 2px 6px #0000000d}.turno-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:#1b4332;margin-top:0;margin-bottom:.8rem;border-bottom:1px solid #a8dadc;padding-bottom:.5rem;font-size:1.1rem}.turno-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:.4rem;color:#333;font-size:.95rem}.turno-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#2d6a4f}.status-pendiente[_ngcontent-%COMP%]{color:#f0ad4e;font-weight:700}.status-aceptado[_ngcontent-%COMP%]{color:#28a745;font-weight:700}.status-rechazado[_ngcontent-%COMP%]{color:#dc3545;font-weight:700}.status-cancelado[_ngcontent-%COMP%]{color:#6c757d;font-weight:700}.status-realizado[_ngcontent-%COMP%]{color:#17a2b8;font-weight:700}.review-button[_ngcontent-%COMP%]{background-color:#74c69d;color:#fff;padding:.6rem 1rem;border-radius:.5rem;font-size:.9rem;float:right;margin-top:.5rem;border:none;cursor:pointer;transition:background-color .2s ease,transform .2s ease}.review-button[_ngcontent-%COMP%]:hover{background-color:#52b788;transform:translateY(-2px)}.no-review-message[_ngcontent-%COMP%]{font-style:italic;color:#888;margin-top:.5rem;font-size:.85rem}.btn-container[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%;margin-top:2rem}.primary-button[_ngcontent-%COMP%]{background-color:#2d6a4f;color:#fff;padding:.8rem 1.5rem;border-radius:.5rem;font-size:1rem;border:none;cursor:pointer;transition:background-color .2s ease,transform .2s ease,box-shadow .2s ease;box-shadow:0 4px 8px #0000001a;text-decoration:none;display:inline-block}.primary-button[_ngcontent-%COMP%]:hover{background-color:#1b4332;transform:translateY(-2px);box-shadow:0 6px 12px #00000026}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#0009;display:flex;justify-content:center;align-items:center;z-index:10000;padding:1rem;box-sizing:border-box}.modal-content[_ngcontent-%COMP%]{background-color:#fffbf0;padding:2rem;border-radius:.8rem;box-shadow:0 5px 15px #0000004d;max-width:90%;max-height:90%;overflow-y:auto;position:relative;width:700px}.modal-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#2d6a4f;margin-top:0;margin-bottom:1.5rem;text-align:center;font-size:1.8rem}.modal-close-button[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;background:none;border:none;font-size:1.5rem;color:#d00000;cursor:pointer;padding:0;line-height:1}.modal-close-button[_ngcontent-%COMP%]:hover{color:#9d0208;transform:scale(1.1)}.review-details[_ngcontent-%COMP%]{padding-top:1rem}.review-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:.75rem;line-height:1.5;color:#333}.review-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#2d6a4f}.review-text[_ngcontent-%COMP%]{background-color:#f0f8f4;border-left:4px solid #74c69d;padding:1rem;margin-top:1rem;margin-bottom:1.5rem;font-style:italic;color:#444}.historia-item-review[_ngcontent-%COMP%]{background-color:#f7fcf9;border:1px dashed #a8dadc;border-radius:.5rem;padding:.8rem;margin-top:1rem;margin-bottom:.5rem;font-size:.9rem}.historia-item-review[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-top:0;margin-bottom:.5rem;color:#1b4332}.historia-item-review[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style-type:disc;padding-left:1.5rem;margin-top:.5rem}.historia-item-review[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.2rem;color:#555}.loading-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#ffffffb3;display:flex;justify-content:center;align-items:center;z-index:9999}.spinner[_ngcontent-%COMP%]{border:6px solid #cfe3d8;border-top:6px solid #2d6a4f;border-radius:50%;width:60px;height:60px;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:20% auto auto}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (max-width: 768px){.pacientes-container[_ngcontent-%COMP%]{padding:1rem}.patient-cards-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:1rem}.patient-card[_ngcontent-%COMP%]{padding-bottom:.5rem}.fav-button[_ngcontent-%COMP%]{width:40px;height:40px;font-size:1rem;bottom:.5rem;right:.5rem}.patient-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1rem}.patient-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.8rem}.selected-patient-details[_ngcontent-%COMP%]{padding:1.5rem}.selected-patient-details[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.5rem}.turno-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:1rem}.turno-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem}.review-button[_ngcontent-%COMP%]{padding:.5rem .8rem;font-size:.85rem}.modal-content[_ngcontent-%COMP%]{padding:1.5rem;max-width:95%}.modal-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.5rem}.modal-close-button[_ngcontent-%COMP%]{font-size:1.2rem;top:.75rem;right:.75rem}.review-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .review-text[_ngcontent-%COMP%]{font-size:.9rem}.historia-item-review[_ngcontent-%COMP%]{padding:.6rem;font-size:.8rem}.primary-button[_ngcontent-%COMP%]{padding:.7rem 1.2rem;font-size:.9rem}}`]})}}return t})();export{he as PacientesComponent};
